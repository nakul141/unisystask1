import os
import tempfile
import boto3
from docx2pdf import convert

# Set your S3 bucket name and region
S3_BUCKET_NAME = 'your-s3-bucket-name'
S3_REGION = 'your-s3-bucket-region'

s3 = boto3.client('s3', region_name=S3_REGION)

def lambda_handler(event, context):
    try:
        # Get the uploaded file from the event
        file_content = event['body']

        # Create a temporary directory to store the DOCX file
        with tempfile.TemporaryDirectory() as tmpdir:
            docx_path = os.path.join(tmpdir, 'input.docx')
            pdf_path = os.path.join(tmpdir, 'output.pdf')

            # Save the uploaded file as a DOCX
            with open(docx_path, 'wb') as f:
                f.write(file_content)

            # Convert DOCX to PDF
            convert(docx_path, pdf_path)

            # Upload the PDF to S3
            s3.upload_file(pdf_path, S3_BUCKET_NAME, 'output.pdf')

        return {
            'statusCode': 200,
            'body': 'File converted and uploaded successfully.'
        }
    except Exception as e:
        return {
            'statusCode': 500,
            'body': f'Error: {str(e)}'
        }
